<h3>Test Run Results</h3>

<div ng-show="resultsData"  class="container-fluid">
    <div class="row">
        <div class="pull-left">
            <div class="test-report">
                <strong>Test ID:</strong> {{testId}}<br />
                <div ng-if="isEditingAllowed()"><strong>Cloud ID:</strong> <a ui-sref="cloudDetail({cloud_id: resultsData.cpid})">{{resultsData.cpid}}</a><br /></div>
                <strong>Upload Date:</strong> {{resultsData.created_at}} UTC<br />
                <strong>Duration:</strong> {{resultsData.duration_seconds}} seconds<br />
                <strong>Total Number of Passed Tests:</strong>
                <a title="See all passed tests" ng-click="openFullTestListModal()">
                    {{resultsData.results.length}}
                </a><br />
                <div ng-if="isKnownCloud()">
                    <strong>Cloud name:</strong> {{resultsData.cloud_name}}<br />
                    <strong>Cloud description:</strong> {{resultsData.cloud_description}}<br />
                </div>
                <hr>
            </div>
        </div>
        <div class="pull-right">
            <div ng-show="isEditingAllowed()">
                <button class="btn btn-warning" ng-hide="isShared()" ng-click="shareTestRun(true)" confirm="Are you sure you want to share these test run results with the community?">Share</button>
                <button class="btn btn-success" ng-show="isShared()" ng-click="shareTestRun(false)">Unshare</button>
                <button type="button" class="btn btn-danger" ng-click="deleteTestRun()" confirm="Are you sure you want to delete these test run results?">Delete</button>
            </div>
        </div>
    </div>
</div>

<div ng-show="resultsData">
    <p>See how these results stack up against DefCore capabilities and OpenStack
        <a target="_blank" href="http://www.openstack.org/brand/interop/">target marketing programs.</a>
    </p>

    <!-- User Options -->
    <div class="row">
        <div class="col-md-3">
            <strong>Capabilities Version:</strong>
            <select ng-model="version" ng-change="updateCapabilities()" class="form-control">
                <!-- Slicing the version file name here gets rid of the '.json' file extension -->
                <option ng-repeat="versionFile in versionList" value="{{versionFile}}">{{versionFile.slice(0, -5)}}</option>
            </select>
        </div>
        <div class="col-md-4">
            <strong>Target Program:</strong>
            <select ng-model="target" class="form-control" ng-change="buildCapabilitiesObject()">
                <option value="platform">OpenStack Powered Platform</option>
                <option value="compute">OpenStack Powered Compute</option>
                <option value="object">OpenStack Powered Object Storage</option>
                <option value="aws">Amazon EC2</option>
            </select>
        </div>
    </div>
    <!-- End User Options -->

    <br />
    <strong>Corresponding OpenStack Releases:</strong>
    <ul class="list-inline">
        <li ng-repeat="release in capabilityData.releases">
            {{release | capitalize}}
        </li>
    </ul>
    <hr >

    <div ng-show="capabilityData">
        <strong>Status:</strong>
        <p>This cloud passes <strong>{{requiredPassPercent | number:1}}% </strong>
           ({{caps.required.passedCount}}/{{caps.required.count}})
           of the tests in the <strong>{{version.slice(0, -5)}}</strong> <em>required</em> capabilities for the
           <strong>{{targetMappings[target]}}</strong> program. <br />
           Excluding flagged tests, this cloud passes
           <strong>{{nonFlagRequiredPassPercent | number:1}}%</strong>
           ({{nonFlagPassCount}}/{{totalNonFlagCount}})
           of the <em>required</em> tests.
        </p>

        <p>Compliance with <strong>{{version.slice(0, -5)}}</strong>:
            <strong>
                <span ng-if="nonFlagPassCount === totalNonFlagCount" class="yes">YES</span>
                <span ng-if="nonFlagPassCount !== totalNonFlagCount" class="no">NO</span>
            </strong>
        </p>

        <hr>
        <h4>Capability Overview</h4>

        Test Filters:<br />
        <div class="btn-group button-margin" data-toggle="buttons">
            <label class="btn btn-default" ng-class="{'active': testStatus === 'all'}">
                <input type="radio" ng-model="testStatus" value="all">
                <span class="text-primary">All</span>
            </label>
            <label class="btn btn-default" ng-class="{'active': testStatus === 'passed'}">
                <input type="radio" ng-model="testStatus" value="passed">
                <span class="text-success">Passed</span>
            </label>
            <label class="btn btn-default" ng-class="{'active': testStatus === 'failed'}">
                <input type="radio" ng-model="testStatus" value="failed">
                <span class="text-danger">Failed</span>
            </label>
            <label class="btn btn-default" ng-class="{'active': testStatus === 'flagged'}">
                <input type="radio" ng-model="testStatus" value="flagged">
                <span class="text-warning">Flagged</span>
            </label>
        </div>

        <accordion close-others=false>
            <!-- The ng-repeat is used to pass in a local variable to the template. -->
            <ng-include
                ng-repeat="status in ['required']"
                src="detailsTemplate"
                onload="isOpen = true">
            </ng-include>
            <br />
            <ng-include
                ng-repeat="status in ['advisory']"
                src="detailsTemplate">
            </ng-include>
            <br />
            <ng-include
                ng-repeat="status in ['deprecated']"
                src="detailsTemplate">
            </ng-include>
            <br />
            <ng-include
                ng-repeat="status in ['removed']"
                src="detailsTemplate">
            </ng-include>
        </accordion>
    </div>
</div>

<div class="loading">
    <div cg-busy="{promise:versionsRequest,message:'Loading versions'}"></div>
    <div cg-busy="{promise:capsRequest,message:'Loading capabilities'}"></div>
    <div cg-busy="{promise:resultsRequest,message:'Loading results'}"></div>
</div>

<div ng-show="showError" class="alert alert-danger" role="alert">
    <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
    <span class="sr-only">Error:</span>
    {{error}}
</div>
